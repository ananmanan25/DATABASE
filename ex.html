<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ultimate Enterprise Manager - Pro Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #0f172a; --accent: #2563eb; --success: #10b981; --warning: #f59e0b; --danger: #ef4444; --light: #f8fafc; }
        body { font-family: 'Inter', sans-serif; background: #f1f5f9; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar */
        aside { width: 280px; background: var(--primary); color: white; padding: 1.5rem; display: flex; flex-direction: column; }
        .logo { font-size: 1.5rem; font-weight: 800; color: #38bdf8; margin-bottom: 2rem; display: flex; align-items: center; gap: 10px; }
        .nav-link { padding: 12px; color: #94a3b8; text-decoration: none; border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: 0.2s; }
        .nav-link:hover, .nav-link.active { background: #1e293b; color: white; }
        
        /* Main Content */
        main { flex: 1; overflow-y: auto; padding: 2rem; }
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; background: white; padding: 1rem 2rem; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        
        .currency-toggle { background: #e2e8f0; padding: 5px; border-radius: 8px; display: flex; gap: 5px; }
        .curr-btn { border: none; padding: 5px 15px; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .curr-btn.active { background: var(--accent); color: white; }

        .stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .stat-card h4 { margin: 0; color: #64748b; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .stat-card .val { font-size: 1.5rem; font-weight: 700; margin: 10px 0; }

        .card { background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 2rem; }
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        th { text-align: left; padding: 12px; background: #f8fafc; color: #475569; border-bottom: 2px solid #e2e8f0; }
        td { padding: 12px; border-bottom: 1px solid #f1f5f9; }

        .btn { border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.2s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-p { background: var(--accent); color: white; }
        .btn-s { background: var(--success); color: white; }
        .btn-w { background: var(--warning); color: white; }
        .btn-d { background: var(--danger); color: white; }

        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:100; justify-content:center; align-items:center; }
        .modal-content { background:white; padding:2rem; border-radius:12px; width:500px; max-height: 90vh; overflow-y: auto; }
        .form-group { margin-bottom: 1rem; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box; }
    </style>
</head>
<body>

<aside>
    <div class="logo"><i class="fas fa-crown"></i>ANANMANAN DATA-BASE</div>
    <div class="nav-link active" onclick="showPage('dash')"><i class="fas fa-chart-line"></i> Dashboard</div>
    <div class="nav-link" onclick="showPage('inv')"><i class="fas fa-box-open"></i> Inventory Editor</div>
    <div class="nav-link" onclick="showPage('led')"><i class="fas fa-history"></i> Ledger & Expenses</div>
    
    <div style="margin-top:auto; background:#1e293b; padding:1rem; border-radius:12px;">
        <small>Exchange Rate (1 USD)</small>
        <input type="number" id="rate-input" value="300" onchange="updateRate()" style="margin-top:5px; background:#0f172a; color:white; border:none;">
    </div>
</aside>

<main>
    <div class="header-bar">
        <h2>Enterprise Dashboard</h2>
        <div class="currency-toggle">
            <button class="curr-btn active" id="btn-usd" onclick="setCurrency('USD')">USD</button>
            <button class="curr-btn" id="btn-lkr" onclick="setCurrency('LKR')">LKR</button>
        </div>
    </div>

    <div class="stat-grid">
        <div class="stat-card"><h4>Business Balance</h4><div class="val" id="stat-balance">0.00</div></div>
        <div class="stat-card"><h4>Stock Value</h4><div class="val" id="stat-stock">0.00</div></div>
        <div class="stat-card"><h4>Total Revenue</h4><div class="val" id="stat-rev">0.00</div></div>
        <div class="stat-card"><h4>Expenses</h4><div class="val" id="stat-exp">0.00</div></div>
    </div>

    <div style="display:flex; gap:1rem; margin-bottom:2rem;">
        <button class="btn btn-p" onclick="openModal('sale')"><i class="fas fa-cart-plus"></i> Record Sale</button>
        <button class="btn btn-d" onclick="openModal('expense')"><i class="fas fa-file-invoice-dollar"></i> Add Expense</button>
        <button class="btn btn-s" onclick="openModal('capital')"><i class="fas fa-university"></i> Add Personal Capital</button>
        <button class="btn btn-w" onclick="openModal('newItem')"><i class="fas fa-plus"></i> Add New Product/Color</button>
    </div>

    <div id="page-dash">
        <div class="card">
            <h3>Quick Inventory Glance</h3>
            <table id="dash-inv-table">
                <thead><tr><th>Product</th><th>Color</th><th>Size</th><th>Stock</th><th>Price</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div id="page-inv" style="display:none">
        <div class="card">
            <h3>Master Inventory & Price Editor</h3>
            <table id="master-inv-table">
                <thead><tr><th>Product</th><th>Color/Size</th><th>Qty</th><th>Cost</th><th>Retail</th><th>Actions</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div id="page-led" style="display:none">
        <div class="card">
            <h3>Full Transaction History</h3>
            <table id="ledger-table">
                <thead><tr><th>Date</th><th>Type</th><th>Description</th><th>Amount</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</main>

<div id="modal" class="modal">
    <div class="modal-content">
        <h3 id="modal-title">Action</h3>
        <div id="modal-body"></div>
        <div style="margin-top:20px; display:flex; gap:10px;">
            <button class="btn btn-p" onclick="handleModalSubmit()">Process</button>
            <button class="btn" onclick="closeModal()">Cancel</button>
        </div>
    </div>
</div>

<script>
    // INITIAL SYSTEM DATA
    let initialInventory = [
        { id: 1, name: "Naruto", color: "Black", size: "M", qty: 3, cost: 10, price: 25 },
        { id: 2, name: "Naruto", color: "Black", size: "L", qty: 2, cost: 10, price: 25 },
        { id: 3, name: "Stitch", color: "Black", size: "XL", qty: 3, cost: 15, price: 35 },
        { id: 4, name: "Member's Edition", color: "Blue", size: "Mix", qty: 7, cost: 12, price: 28 },
        { id: 5, name: "K-Samurai", color: "White", size: "M", qty: 3, cost: 10, price: 25 }
    ];

    let db = JSON.parse(localStorage.getItem('ent_db')) || {
        inventory: initialInventory,
        ledger: [],
        currency: 'USD',
        rate: 300,
        balance: 0
    };

    function updateRate() { db.rate = parseFloat(document.getElementById('rate-input').value); save(); }
    function setCurrency(c) { db.currency = c; save(); }

    function save() {
        localStorage.setItem('ent_db', JSON.stringify(db));
        render();
    }

    function format(amt) {
        if (db.currency === 'LKR') return 'Rs. ' + (amt * db.rate).toLocaleString();
        return '$' + amt.toLocaleString();
    }

    function render() {
        // Stats
        let stockVal = db.inventory.reduce((a, b) => a + (b.qty * b.price), 0);
        let rev = db.ledger.filter(l => l.type === 'Sale' || l.type === 'Capital').reduce((a, b) => a + b.amt, 0);
        let exp = db.ledger.filter(l => l.type === 'Expense').reduce((a, b) => a + b.amt, 0);
        db.balance = rev - exp;

        document.getElementById('stat-balance').innerText = format(db.balance);
        document.getElementById('stat-stock').innerText = format(stockVal);
        document.getElementById('stat-rev').innerText = format(rev);
        document.getElementById('stat-exp').innerText = format(exp);
        
        document.getElementById('btn-usd').className = db.currency === 'USD' ? 'curr-btn active' : 'curr-btn';
        document.getElementById('btn-lkr').className = db.currency === 'LKR' ? 'curr-btn active' : 'curr-btn';

        // Inventory Tables
        const dashT = document.querySelector('#dash-inv-table tbody');
        const masterT = document.querySelector('#master-inv-table tbody');
        dashT.innerHTML = ''; masterT.innerHTML = '';

        db.inventory.forEach((item, idx) => {
            dashT.innerHTML += `<tr><td>${item.name}</td><td>${item.color}</td><td>${item.size}</td><td>${item.qty}</td><td>${format(item.price)}</td></tr>`;
            masterT.innerHTML += `<tr>
                <td>${item.name}</td>
                <td>${item.color}/${item.size}</td>
                <td><input type="number" value="${item.qty}" onchange="updateInv(${idx}, 'qty', this.value)"></td>
                <td><input type="number" value="${item.cost}" onchange="updateInv(${idx}, 'cost', this.value)"></td>
                <td><input type="number" value="${item.price}" onchange="updateInv(${idx}, 'price', this.value)"></td>
                <td><button onclick="deleteInv(${idx})" class="btn-d" style="padding:5px">X</button></td>
            </tr>`;
        });

        // Ledger
        const ledT = document.querySelector('#ledger-table tbody');
        ledT.innerHTML = '';
        db.ledger.slice().reverse().forEach(l => {
            ledT.innerHTML += `<tr><td>${l.date}</td><td>${l.type}</td><td>${l.desc}</td><td>${format(l.amt)}</td></tr>`;
        });
    }

    function updateInv(idx, field, val) { db.inventory[idx][field] = parseFloat(val); save(); }
    function deleteInv(idx) { if(confirm('Delete this item?')) { db.inventory.splice(idx, 1); save(); }}

    function showPage(p) {
        ['dash','inv','led'].forEach(id => document.getElementById('page-'+id).style.display = 'none');
        document.getElementById('page-'+p).style.display = 'block';
        document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
        event.currentTarget.classList.add('active');
    }

    let activeAction = '';
    function openModal(action) {
        activeAction = action;
        const modal = document.getElementById('modal');
        const body = document.getElementById('modal-body');
        modal.style.display = 'flex';
        
        if(action === 'sale') {
            body.innerHTML = `<div class="form-group"><label>Product</label><select id="f-item">${db.inventory.map(i=>`<option value="${i.id}">${i.name} (${i.color})</option>`).join('')}</select></div>
                             <div class="form-group"><label>Quantity</label><input type="number" id="f-qty" value="1"></div>
                             <div class="form-group"><label>Discount (${db.currency})</label><input type="number" id="f-disc" value="0"></div>`;
        } else if(action === 'expense' || action === 'capital') {
            body.innerHTML = `<div class="form-group"><label>Description</label><input type="text" id="f-desc" placeholder="What is this for?"></div>
                             <div class="form-group"><label>Amount (${db.currency})</label><input type="number" id="f-amt"></div>`;
        } else if(action === 'newItem') {
            body.innerHTML = `<div class="form-group"><label>Name</label><input type="text" id="n-name"></div>
                             <div class="form-group"><label>Color</label><input type="text" id="n-color"></div>
                             <div class="form-group"><label>Size</label><input type="text" id="n-size"></div>
                             <div class="form-group"><label>Qty</label><input type="number" id="n-qty"></div>
                             <div class="form-group"><label>Retail Price (USD)</label><input type="number" id="n-price"></div>`;
        }
    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }

    function handleModalSubmit() {
        const now = new Date().toLocaleDateString();
        if(activeAction === 'sale') {
            const item = db.inventory.find(i => i.id == document.getElementById('f-item').value);
            const qty = parseInt(document.getElementById('f-qty').value);
            const disc = parseFloat(document.getElementById('f-disc').value);
            const finalAmt = (item.price * qty) - (db.currency === 'LKR' ? disc/db.rate : disc);
            
            if(item.qty < qty) return alert('No stock!');
            item.qty -= qty;
            db.ledger.push({ date: now, type: 'Sale', desc: `Sold ${qty}x ${item.name} (- discount)`, amt: finalAmt });
        } else if(activeAction === 'expense' || activeAction === 'capital') {
            let amt = parseFloat(document.getElementById('f-amt').value);
            if(db.currency === 'LKR') amt = amt / db.rate;
            db.ledger.push({ date: now, type: activeAction === 'expense' ? 'Expense' : 'Capital', desc: document.getElementById('f-desc').value, amt: amt });
        } else if(activeAction === 'newItem') {
            db.inventory.push({
                id: Date.now(),
                name: document.getElementById('n-name').value,
                color: document.getElementById('n-color').value,
                size: document.getElementById('n-size').value,
                qty: parseInt(document.getElementById('n-qty').value),
                cost: 0, price: parseFloat(document.getElementById('n-price').value)
            });
        }
        save(); closeModal();
    }

    window.onload = render;
</script>
</body>
</html>